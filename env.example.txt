#
# This file is an EXAMPLE. Copy to `.env` (or export vars in your shell) before running docker-compose.
# Compose uses `network_mode: host` heavily, so most services are reached on 127.0.0.1, while any
# browser-facing URLs should use your LAN IP (example below: 192.168.50.222).
#

# ---------- Public / Paths ----------
# Base URL that browsers should use to reach the orchestrator (LAN IP recommended).
PUBLIC_BASE_URL=http://192.168.50.222:8000

# Artifact/root paths inside containers (these are mounted named volumes in compose).
UPLOAD_DIR=/workspace/uploads
# Optional override; if unset, orchestrator derives it from UPLOAD_DIR.
STATE_DIR=/workspace/uploads/state

# (Legacy paths kept for compatibility with older layouts / tooling)
DATASETS_ROOT=/workspace/uploads/artifacts/datasets
REF_ROOT=/workspace/uploads/artifacts/refs
PROMPTS_ROOT=/workspace/uploads/artifacts/prompts

# Extra CORS origins (comma-separated), if you access from additional hosts.
CORS_EXTRA_ORIGINS=


# ---------- Logging ----------
# Orchestrator logs:
ORCH_LOG_LEVEL=DEBUG
ORCH_LOG_DIR=/workspace/logs
ORCH_LOG_FILE=

# Generic services log dir (many microservices read LOG_DIR).
LOG_DIR=/workspace/logs
# Generic services log level and optional explicit log filename.
LOG_LEVEL=INFO
LOG_FILE=


# ---------- Orchestrator / Zero-touch ----------
ICW_MODE=committee
ICW_DISABLE=0
ABLATE=on
ABLATE_EXPORT=on
ABLATE_SCOPE=auto
AUTO_EXECUTE_TOOLS=true
ALLOW_TOOL_EXECUTION=true

# Optional: HTTP bridge for MCP tools (when running tools outside the orchestrator container).
MCP_HTTP_BRIDGE_URL=


# ---------- Orchestrator runtime knobs ----------
DEFAULT_NUM_CTX=32768
DEFAULT_TEMPERATURE=0.3
PLANNER_MODEL=qwen3
ENABLE_DEBATE=true
MAX_DEBATE_TURNS=1
COMMITTEE_ROUNDS=1
ENABLE_WEBSEARCH=true
RAG_CACHE_TTL_SEC=300
JOBS_RAG_INDEX=true

# Committee payload size control:
# - Default: embeddings are kept in tool envelopes/args but omitted from the temporary LLM-facing committee context
#   (LLMs canâ€™t use raw vectors directly; we send embedding_context + metric_guide instead).
# - Set to 1 ONLY if you want the committee LLM to receive full embedding arrays.
COMMITTEE_SEND_EMBEDDINGS=0

# Streaming (0 disables chunking)
STREAM_CHUNK_SIZE_CHARS=0
STREAM_CHUNK_INTERVAL_MS=50

# Dataset streaming exporter
DATASETS_STREAM_ROOT=
DATASETS_STREAM_NAME=dataset
# Default is large to avoid too many shards (falls back to ARTIFACT_SHARD_BYTES if unset).
DATASETS_STREAM_SHARD_BYTES=

# Artifact buffering/sharding
ARTIFACT_SHARD_BYTES=200000
ARTIFACT_LATEST_ONLY=true
EVENT_BUFFER_MAX=100
HISTORY_GRACE_SECONDS=86400

# Code loop tuning
REPO_ROOT=/workspace
CODE_LOOP_STEP_TOKENS=900

# Wrapper config file path (read by orchestrator)
WRAPPER_CONFIG_PATH=/workspace/configs/wrapper_config.json


# ---------- ComfyUI ----------
# Compose currently pins this to a LAN IP; with host networking you can also use http://127.0.0.1:8188.
COMFYUI_API_URL=http://192.168.50.222:8188
# Optional legacy/alias supported by some code paths.
COMFYUI_BASE_URL=
# Optional: distribute across multiple ComfyUI endpoints.
COMFYUI_API_URLS=
COMFYUI_REPLICAS=1

# Submission controls
SCENE_SUBMIT_CONCURRENCY=4
SCENE_MAX_BATCH_FRAMES=2
RESUME_MAX_RETRIES=3

# Backoff/retry behavior
COMFYUI_BACKOFF_MS=250
COMFYUI_BACKOFF_MAX_MS=4000
COMFYUI_MAX_RETRIES=6

# Optional: treat Comfy graphs as CPU-first (some graphs switch behavior)
COMFY_CPU_MODE=false

# Workflow used by orchestrator
COMFY_WORKFLOW_PATH=/workspace/services/image/workflows/stock_smoke.json

# Where orchestrator will place assets so ComfyUI LoadImage nodes can see them
COMFY_INPUT_DIR=/comfyui/input

# Upscaler
COMFY_UPSCALE_MODEL=4x-UltraSharp.pth
COMFY_UPSCALE_MODEL_URL=
COMFY_UPSCALE_MODEL_SHA256=

# RIFE VFI (video frame interpolation) service
VFI_API_URL=http://127.0.0.1:8098
VFI_GPU=all
RIFE_UVICORN_WORKERS=2

# Real-ESRGAN upscale service
UPSCALE_API_URL=http://127.0.0.1:8099
UPSCALE_GPU=all
UPSCALE_UVICORN_WORKERS=1
REALESRGAN_MODEL_NAME=RealESRGAN_x4plus
REALESRGAN_TILE=0


# ---------- Core service URLs (host-network defaults) ----------
OCR_API_URL=http://127.0.0.1:8070
VLM_API_URL=http://127.0.0.1:8050
WHISPER_API_URL=http://127.0.0.1:9090
XTTS_API_URL=http://127.0.0.1:8020
FACEID_API_URL=http://127.0.0.1:7000
MUSIC_API_URL=http://127.0.0.1:7860
RVC_API_URL=http://127.0.0.1:7863
VOCAL_FIXER_API_URL=http://127.0.0.1:7864
MFA_API_URL=http://127.0.0.1:7867
VISION_REPAIR_API_URL=http://127.0.0.1:8095
DEMUCS_API_URL=http://127.0.0.1:9101

# Internal pipeline helpers
DRT_API_URL=http://127.0.0.1:8086
EXECUTOR_BASE_URL=http://127.0.0.1:8081

# Optional alternates/overrides (used in some code paths)
MUSIC_FULL_API_URL=

# Optional/legacy endpoints (not used by default)
SAO_API_URL=
DIFFSINGER_RVC_API_URL=
SVD_API_URL=
HUNYUAN_FOLEY_API_URL=
# Legacy (do not use): old standalone hunyuan service
HUNYUAN_VIDEO_API_URL=http://127.0.0.1:9007
# Diffusers HunyuanVideo service (recommended)
HYVIDEO_API_URL=http://127.0.0.1:8094

# HunyuanVideo service runtime tuning (used by services/hunyuan_video)
HYVIDEO_PORT=8094
# OFFLINE ONLY (recommended for this compose): point at the local model directory from bootstrap
HYVIDEO_MODEL_ID=/opt/models/hunyuan_diffusers
HYVIDEO_DEVICE=cuda:0
HYVIDEO_TRANSFORMER_DTYPE=bf16
HYVIDEO_PIPE_DTYPE=fp16
HYVIDEO_CPU_OFFLOAD=1
HYVIDEO_VAE_TILING=1

# --- Hunyuan SR (720->1080 super-resolution) ---
HYVIDEO_SR_ENABLE=1
HYVIDEO_SR_ROOT=/opt/models/hunyuan
HYVIDEO_SR_TRANSFORMER_SUBFOLDER=transformer/1080p_sr_distilled
HYVIDEO_SR_UPSAMPLER_SUBFOLDER=upsampler/1080p_sr_distilled
HYVIDEO_SR_SCHEDULER_SUBFOLDER=scheduler
HYVIDEO_SR_NUM_INFERENCE_STEPS=8
HYVIDEO_SR_GUIDANCE_SCALE=1.0
HYVIDEO_SR_TARGET_WIDTH=1920
HYVIDEO_SR_TARGET_HEIGHT=1080
HYVIDEO_SR_INTERNAL_MULTIPLE=16

# Attention backend (optional)
HYVIDEO_ATTENTION_BACKEND=


# ---------- Film-2 QA thresholds (kept) ----------
FILM2_QA_T_FACE=0.85
FILM2_QA_T_VOICE=0.85
FILM2_QA_T_MUSIC=0.80


# ---------- Aesthetic / scoring ----------
# In compose this is mounted under /opt/models/aesthetic/...
AESTHETIC_HEAD_PATH=/opt/models/aesthetic/laion_v2_linear_L14.pt
# Optional: if you want bootstrap to download the head weights.
AESTHETIC_HEAD_URL=
AESTHETIC_CLIP_MODEL_NAME=ViT-L-14
AESTHETIC_CLIP_PRETRAINED=laion2b_s32b_b82k


# ---------- Film2 storage (paths inside orchestrator container) ----------
FILM2_MODELS=/opt/models
FILM2_DATA=/srv/film2


# ---------- Postgres / RAG ----------
# With host networking, the orchestrator uses 127.0.0.1 in compose; keep that default here.
POSTGRES_HOST=127.0.0.1
POSTGRES_PORT=5432
POSTGRES_DB=ragdb
POSTGRES_USER=rag
POSTGRES_PASSWORD=ragpass
EMBEDDING_MODEL_NAME=BAAI/bge-large-en-v1.5


# ---------- NVIDIA / GPU ----------
NVIDIA_VISIBLE_DEVICES=all
NVIDIA_DRIVER_CAPABILITIES=compute,utility
NVIDIA_DISABLE_REQUIRE=1

# Per-service GPU selectors (compose uses these)
OLLAMA_QWEN_GPU=all
OLLAMA_GLM_GPU=all
OLLAMA_DEEPSEEK_GPU=all
MUSIC_GPU=all
VISION_REPAIR_GPU=all
VIDEO_GPU=all

# ComfyUI init (optional GPU pinning per replica)
COMFYUI_GPU_DEVICES=


# ---------- HF / Hub behavior ----------
HF_HUB_ENABLE_HF_TRANSFER=1
HF_HUB_ENABLE_XET=0
HF_MAX_WORKERS=4
HF_HUB_ENABLE_PROGRESS_BARS=1

# Cache dirs (note: different services use different defaults; these are safe generic defaults)
HF_HOME=/models/hf
TRANSFORMERS_CACHE=/models/hf
TORCH_HOME=/models/torch


# ---------- Torch channel (P40 + RTX8000 compatible) ----------
PIP_EXTRA_INDEX_URL=https://download.pytorch.org/whl/cu118


# ---------- LLMs / Defaults ----------
QWEN_MODEL_ID=huihui_ai/qwen3-abliterated:30b-a3b-q4_K_M
QWEN_BASE_URL=http://127.0.0.1:11435

GLM_MODEL_ID=hf.co/unsloth/GLM-4.6V-Flash-GGUF:BF16
GLM_OLLAMA_BASE_URL=http://127.0.0.1:11433

DEEPSEEK_CODER_MODEL_ID=huihui-ai/DeepSeek-R1-Distill-Qwen-32B-abliterated
DEEPSEEK_CODER_OLLAMA_BASE_URL=http://127.0.0.1:11436

# Committee (if unset, orchestrator derives it from the three model IDs above)
COMMITTEE_MODEL_ID=committee:huihui_ai/qwen3-abliterated:30b-a3b-q4_K_M+hf.co/unsloth/GLM-4.6V-Flash-GGUF:BF16+huihui-ai/DeepSeek-R1-Distill-Qwen-32B-abliterated

QWEN_VL_MODEL_ID=huihui_ai/qwen3-vl-abliterated:30b-a3b-Thinking-v2-q4_K_M


# ---------- Whisper / XTTS ----------
WHISPER_MODEL_NAME=large-v3
WHISPER_CPU_THREADS=8
XTTS_MODEL_NAME=tts_models/multilingual/multi-dataset/xtts_v2
XTTS_VOICE_MODEL_MAP_PATH=/root/.local/share/tts/voice_model_map.json
# Optional JSON map for per-voice model switching inside XTTS service.
XTTS_VOICE_MODEL_MAP=
# Required by Coqui-TTS images; compose sets this automatically for the xtts service.
COQUI_TOS_AGREED=1


# ---------- Music service models ----------
# If you mount local musicgen weights into the music service, set MUSIC_MODEL_DIR to that folder.
MUSIC_MODEL_DIR=/opt/models/music
# Optional: HF repo id fallback when a local path doesn't exist.
MUSIC_MODEL_ID=facebook/musicgen-large


# ---------- RVC defaults / FaceID overrides ----------
RVC_DEFAULT_MALE_VOICE_ID=TITAN
RVC_DEFAULT_FEMALE_VOICE_ID=TITAN
# Optional generic default (used by some tool paths)
RVC_DEFAULT_VOICE_ID=

# FaceID service model selection overrides (optional)
INSIGHTFACE_HOME=/models/insightface
INSIGHTFACE_MODEL_ROOT=
FACEID_FACE_MODEL=
FACEID_CTX_ID=
LOCKS_FACE_MODEL=
LOCKS_FACE_CTX_ID=


# ---------- Bootstrap helpers (optional) ----------
MUSIC_ENGINE_REPO=
MUSIC_ENGINE_TARBALL_URL=


# ---------- Executor sandbox ----------
WORKSPACE_DIR=/workspace
EXEC_MEMORY_MB=2048
ALLOW_SHELL=false
SHELL_WHITELIST=
ORCHESTRATOR_BASE_URL=http://127.0.0.1:8000
EXECUTOR_MAX_ATTEMPTS=3
# Optional executor DB DSN (used by utc/db.py)
PG_DSN=


# ---------- DRT (deep research tool) ----------
DRT_RESPECT_ROBOTS=true
DRT_ROBOTS_TTL_S=900
DRT_RATE_MIN_GAP_MS=200
# Optional (for paywalled/geo content): local cookie/header injection for the resolver.
MEDIA_COOKIES_FILE=
MEDIA_HEADERS_JSON=


# ---------- Ablation layer (optional) ----------
ABLCODER_URL=


# ---------- Chat UI (optional container) ----------
ORCHESTRATOR_URL=http://127.0.0.1:8000
PUBLIC_ORCH_BASE=http://192.168.50.222:8000


# ---------- Service-specific tuning (rarely needed) ----------
USE_FP16=0

# Vocalfix tuning (used by vocalfix service)
AUDIO_KEY=E minor
AUDIO_SIBILANCE_DB_MAX=-16

# Vision repair tuning
VISION_REPAIR_YOLO_MODEL=yolov8x.pt


# ---------- RVC trainer / mining ----------
SPKREC_MODEL_ID=speechbrain/spkrec-ecapa-voxceleb


# ---------- Tokens ----------
HUGGINGFACE_TOKEN=<your_hf_token>
SERPAPI_API_KEY=
